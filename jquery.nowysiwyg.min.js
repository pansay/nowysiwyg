(function(l,f){var g=function(b,a){this.elem=b;this.$elem=f(b);this.options=a;this.metadata=this.$elem.data("nowysiwyg-options");that=this};g.prototype={defaults:{buttons:{top:["ax","a","p"],right:["h6","h5","h4","h3"],bottom:["rq","lq","rqf","lqf","bq"],left:["b","i","uc"]},size:25,wrapperClass:"nowysiwyg-wrapper",stylesWrapper:{display:"block",position:"relative"},stylesWrapperInherited:"width height margin-top margin-right margin-bottom margin-left".split(" "),stylesTextarea:{position:"absolute",
"margin-top":"0","margin-right":"0","margin-bottom":"0","margin-left":"0"},stylesTextareaSaved:{},sides:["top","right","bottom","left"],oppositeSides:{top:"bottom",right:"left",bottom:"top",left:"right"},nextSides:{top:"right",right:"bottom",bottom:"left",left:"top"},previousSides:{top:"left",right:"top",bottom:"right",left:"bottom"},stylesButtonsSetsCommon:{position:"absolute",display:"table"},stylesButtonsSets:{},stylesButtonsCommon:{display:"table","float":"left"},stylesButtonsCommonInner:{display:"table-cell",
"text-align":"center","vertical-align":"middle",cursor:"pointer"},stylesButtonsCommonInnerInheritedOff:{"background-color":"background-color",color:"color"},stylesButtonsCommonInnerInheritedOn:{"background-color":"color",color:"background-color"},stylesButtonsCommonInnerOff:{},stylesButtonsCommonInnerOn:{},stylesButtons:{},stylesInherited:["font-family","font-size"],stylesInheritedBorders:["color","style","width"]},init:function(){this.config=f.extend(!0,{},this.defaults,this.options,this.metadata);
this.removePrevious();this.setStyles();this.create();this.handleResize();return this},removePrevious:function(){if("undefined"!=typeof this.$elem.data("saved-styles")){this.$elem.siblings("ul").remove();this.$elem.unwrap(this.config.wrapperClass);var b=this.$elem.data("saved-styles");this.$elem.css(b)}},setStyles:function(){var b=this.config.size;this.config.stylesButtonsCommonInner.width=b+"px";this.config.stylesButtonsCommonInner.height=b+"px";for(var a in this.config.stylesTextarea){var c=this.$elem.css(a);
this.config.stylesTextareaSaved[a]=c}for(;a=this.config.stylesInherited.pop();)this.config.stylesButtonsSetsCommon[a]=this.$elem.css(a);for(;a=this.config.stylesWrapperInherited.pop();)this.config.stylesWrapper[a]=this.$elem.css(a);for(a in this.config.stylesButtonsCommonInnerInheritedOff)c=this.config.stylesButtonsCommonInnerInheritedOff[a],this.config.stylesButtonsCommonInnerOff[a]=this.$elem.css(c);for(a in this.config.stylesButtonsCommonInnerInheritedOn)c=this.config.stylesButtonsCommonInnerInheritedOn[a],
this.config.stylesButtonsCommonInnerOn[a]=this.$elem.css(c);for(var c=0,e=this.config.sides.length;c<e;c+=1){var d=this.config.sides[c],g=this.config.nextSides[d],h=this.config.previousSides[d];this.config.stylesButtonsSets[d]={};f.extend(!0,this.config.stylesButtonsSets[d],this.config.stylesButtonsSetsCommon);a="border-"+d+"-width";a=parseInt(this.$elem.css(a));if("left"==d||"right"==d)this.config.stylesButtonsSets[d].width=b+a+"px";this.config.stylesButtonsSets[d][h]=0;this.config.stylesButtonsSets[d][d]=
"-"+(b+a)+"px";this.config.stylesButtons[d]=f.extend(!0,{},this.config.stylesButtonsCommon,this.config.stylesButtons[d]);for(var h=0,l=this.config.stylesInheritedBorders.length;h<l;h+=1){var m=this.config.stylesInheritedBorders[h];a="border-"+d+"-"+m;var n=this.$elem.css(a);this.config.stylesButtonsSets[d]["border-"+g+"-"+m]=n;for(var k=0;k<e;k+=1)a=this.config.sides[k],a!=this.config.oppositeSides[d]&&a!=this.config.nextSides[d]&&(a="border-"+a+"-"+m,this.config.stylesButtons[d][a]=n)}}},create:function(){var b=
this.$elem.wrap('<div class="'+this.config.wrapperClass+'">').parent().css(this.config.stylesWrapper);this.$elem.css(this.config.stylesTextarea).data("saved-styles",this.config.stylesTextareaSaved);for(var a={},c;c=this.config.sides.pop();){a[c]=f("<ul></ul>").css(this.config.stylesButtonsSets[c]);for(var e;e=this.config.buttons[c].pop();)e=this.createButton(e,c),a[c].append(e);b.append(a[c])}},createButton:function(b,a){return f("<li><span></span></li>").data("no-wysiwyg-button-name",b).css(this.config.stylesButtons[a]).find("span").css(this.config.stylesButtonsCommonInner).text(b).hover(function(){f(this).css(that.config.stylesButtonsCommonInnerOn)},
function(){f(this).css(that.config.stylesButtonsCommonInnerOff)}).end().on("click",function(){var a=f(this).data("no-wysiwyg-button-name");that.buttons[a](f(this).closest("div").find("textarea")[0])})},handleResize:function(){this.$elem.bind("mouseup",function(){null===this.oldwidth&&(this.oldwidth=this.style.width);null===this.oldheight&&(this.oldheight=this.style.height);if(this.style.width!=this.oldwidth||this.style.height!=this.oldheight)f(this).trigger("resize"),this.oldwidth=this.style.width,
this.oldheight=this.style.height});this.$elem.on("resize",function(){f(this).nowysiwyg(that.options)})},addTag:function(b,a,c){var e="";if("undefined"!=typeof c)for(var d in options)e+=" "+d+'="'+c[d]+'"';c="<"+b+e+">";b="</"+b+">";if(a.setSelectionRange){e=a.scrollTop;d=a.value.substring(0,a.selectionStart);var f=a.value.substring(a.selectionStart,a.selectionEnd),g=a.value.substring(a.selectionEnd,a.value.length);a.value=d+c+f+b+g;a.scrollTop=e}else e=document.selection.createRange().text,""!=e?
(a=c+e+b,document.selection.createRange().text=a):a.value=a.value+c+b},buttons:{b:function(b){that.addTag("strong",b)},i:function(b){that.addTag("em",b)},uc:function(b){that.addTag("strong",b,{"class":"uppercase"})},p:function(b){that.addTag("p",b)},bq:function(b){that.addTag("blockquote",b)},h3:function(b){that.addTag("h3",b)},h4:function(b){that.addTag("h4",b)},h5:function(b){that.addTag("h5",b)},h6:function(b){that.addTag("h6",b)},a:function(b){that.addTag("a",b,{href:""})},ax:function(b){that.addTag("a",
b,{href:"",rel:"external","class":"external",target:"_blank"})}},custom:{}};g.buttons=g.prototype.buttons;g.defaults=g.prototype.defaults;g.custom=g.prototype.custom;f.fn.nowysiwyg=function(b){return this.each(function(){(new g(this,b)).init()})};l.Nowysiwyg=g})(window,jQuery);